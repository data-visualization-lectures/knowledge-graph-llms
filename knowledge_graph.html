
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Knowledge Graph</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.30.2/cytoscape.min.js"></script>
    <script src="https://unpkg.com/layout-base/layout-base.js"></script>
    <script src="https://unpkg.com/cose-base/cose-base.js"></script>
    <script src="https://unpkg.com/cytoscape-fcose/cytoscape-fcose.js"></script>
    <script src="https://unpkg.com/cytoscape-svg@0.4.0/cytoscape-svg.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #222222;
            color: #ffffff;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        #cy {
            width: 100%;
            height: 100%;
            display: block;
        }
        .export-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        .export-btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .export-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="export-buttons">
        <button class="export-btn" onclick="exportPNG()">ğŸ“· PNG</button>
        <button class="export-btn" onclick="exportSVG()">ğŸ–¼ï¸ SVG</button>
    </div>
    <div id="cy"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Debug: Check if cytoscape-svg is loaded
            console.log('cytoscapeSvg loaded:', typeof cytoscapeSvg !== 'undefined');
            
            // Register cytoscape-svg extension
            if (typeof cytoscapeSvg !== 'undefined') {
                cytoscape.use(cytoscapeSvg);
                console.log('cytoscape-svg extension registered');
            } else {
                console.error('cytoscape-svg extension not found!');
            }
            
            var elements = [{"data": {"id": "å…ˆç”Ÿ", "label": "å…ˆç”Ÿ", "type": "Person"}, "position": {"x": 531.6383734618448, "y": 317.3399734071211}}, {"data": {"id": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "label": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "type": "Person"}, "position": {"x": 434.6515745250115, "y": 124.37167961736286}}, {"data": {"id": "ã‚¸ãƒ§ãƒãƒ³ãƒ‹", "label": "ã‚¸ãƒ§ãƒãƒ³ãƒ‹", "type": "Person"}, "position": {"x": 132.3251322088255, "y": 557.5610386793988}}, {"data": {"id": "ã‚¶ãƒãƒª", "label": "ã‚¶ãƒãƒª", "type": "Person"}, "position": {"x": 764.3119689530465, "y": 447.7839626011284}}, {"data": {"id": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©ã®ãŠçˆ¶ã•ã‚“", "label": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©ã®ãŠçˆ¶ã•ã‚“", "type": "Person"}, "position": {"x": 647.9963381084867, "y": 408.61646649048606}}, {"data": {"id": "åšå£«", "label": "åšå£«", "type": "Person"}, "position": {"x": 254.2378835775603, "y": 207.9200153750065}}, {"data": {"id": "æ•™å®¤", "label": "æ•™å®¤", "type": "Place"}, "position": {"x": 355.12686037787654, "y": 151.5008879211164}}, {"data": {"id": "é›‘èªŒ", "label": "é›‘èªŒ", "type": "Object"}, "position": {"x": 453.7091768509872, "y": 188.1017819265819}}, {"data": {"id": "æ›¸æ–", "label": "æ›¸æ–", "type": "Place"}, "position": {"x": 183.3051209165226, "y": 491.398141139381}}, {"data": {"id": "æœ¬", "label": "æœ¬", "type": "Object"}, "position": {"x": 357.5985263533795, "y": 391.8895383633904}}, {"data": {"id": "å¤©ã®å·", "label": "å¤©ã®å·", "type": "Object"}, "position": {"x": 362.6650461227813, "y": 127.32032026614002}}, {"data": {"id": "æ˜Ÿ", "label": "æ˜Ÿ", "type": "Object"}, "position": {"x": 409.9644242677306, "y": 151.59991553200743}}, {"data": {"id": "å¤ªé™½", "label": "å¤ªé™½", "type": "Object"}, "position": {"x": 236.01619101025898, "y": 151.5304729458031}}, {"data": {"id": "åœ°çƒ", "label": "åœ°çƒ", "type": "Object"}, "position": {"x": 463.45284903782493, "y": 305.6601773006969}}, {"data": {"id": "éŠ€æ²³", "label": "éŠ€æ²³", "type": "Object"}, "position": {"x": 148.81663669875417, "y": 155.24301023550655}}, {"data": {"source": "å…ˆç”Ÿ", "target": "æ•™å®¤", "label": "ä½ç½®ã—ã¦ã„ã‚‹_", "weight": 5, "edge_color": "#FF6B6B"}}, {"data": {"source": "å…ˆç”Ÿ", "target": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "label": "è³ªå•ã™ã‚‹_", "weight": 3, "edge_color": "#4ECDC4"}}, {"data": {"source": "å…ˆç”Ÿ", "target": "ã‚¸ãƒ§ãƒãƒ³ãƒ‹", "label": "è³ªå•ã™ã‚‹_", "weight": 3, "edge_color": "#4ECDC4"}}, {"data": {"source": "ã‚¸ãƒ§ãƒãƒ³ãƒ‹", "target": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "label": "å‹äººã§ã‚ã‚‹_", "weight": 7, "edge_color": "#45B7D1"}}, {"data": {"source": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "target": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©ã®ãŠçˆ¶ã•ã‚“", "label": "å­ä¾›ã§ã‚ã‚‹_", "weight": 10, "edge_color": "#FFA07A"}}, {"data": {"source": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©ã®ãŠçˆ¶ã•ã‚“", "target": "åšå£«", "label": "åŒä¸€äººç‰©ã§ã‚ã‚‹_", "weight": 10, "edge_color": "#98D8C8"}}, {"data": {"source": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "target": "æ›¸æ–", "label": "è¨ªã‚Œã‚‹_", "weight": 4, "edge_color": "#F7DC6F"}}, {"data": {"source": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "target": "æœ¬", "label": "èª­ã‚€_", "weight": 6, "edge_color": "#BB8FCE"}}, {"data": {"source": "ã‚¸ãƒ§ãƒãƒ³ãƒ‹", "target": "é›‘èªŒ", "label": "èª­ã‚€_", "weight": 6, "edge_color": "#BB8FCE"}}, {"data": {"source": "ã‚«ãƒ ãƒ‘ãƒãƒ«ãƒ©", "target": "é›‘èªŒ", "label": "èª­ã‚€_", "weight": 6, "edge_color": "#BB8FCE"}}, {"data": {"source": "å¤©ã®å·", "target": "æ˜Ÿ", "label": "å«ã‚€_", "weight": 8, "edge_color": "#F1948A"}}, {"data": {"source": "éŠ€æ²³", "target": "æ˜Ÿ", "label": "å«ã‚€_", "weight": 8, "edge_color": "#F1948A"}}, {"data": {"source": "å¤ªé™½", "target": "åœ°çƒ", "label": "è¿‘ãã«ã‚ã‚‹_", "weight": 7, "edge_color": "#82E0AA"}}];
            
            var cy = cytoscape({
                container: document.getElementById('cy'),
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'content': 'data(label)',
                            'font-size': '12px',
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'background-color': '#555',
                            'color': '#fff',
                            'text-outline-width': 2,
                            'text-outline-color': '#555',
                            'width': '40px',
                            'height': '40px'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': function(ele) {
                                return Math.max(1, ele.data('weight') / 2);
                            },
                            'line-color': function(ele) {
                                return ele.data('edge_color') || '#AAD8FF';
                            },
                            'target-arrow-color': function(ele) {
                                return ele.data('edge_color') || '#AAD8FF';
                            },
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier',
                            'label': 'data(label)',
                            'font-size': '10px',
                            'text-rotation': 'autorotate',
                            'text-margin-y': -10,
                            'color': '#ffffff',
                            'text-outline-width': 1.5,
                            'text-outline-color': '#222222',
                            'source-arrow-color': '#AAD8FF'
                        }
                    }
                ],
                layout: {
                    name: 'fcose',
                    quality: "default",
                    randomize: true,
                    animate: true,
                    animationDuration: 1000,
                    animationEasing: 'ease-in-out',
                    fit: true,
                    padding: 30,
                    nodeDimensionsIncludeLabels: true,
                    uniformNodeDimensions: false,
                    packComponents: true,
                    step: "all",
                    initialEnergyOnIncremental: 0.3,
                    samplingType: true,
                    sampleSize: 25,
                    nodeSeparation: 75,
                    piTol: 0.0000001,
                    nodeRepulsion: 4500,
                    idealEdgeLength: 50,
                    edgeElasticity: 0.45,
                    nestingFactor: 0.1,
                    gravity: 0.25,
                    numIter: 2500,
                    tile: true,
                    tilingPaddingVertical: 10,
                    tilingPaddingHorizontal: 10,
                    gravityRangeCompound: 1.5,
                    gravityCompound: 1.0,
                    gravityRange: 3.8,
                    initialEnergyOnIncremental: 0.3
                }
            });
        
            // Store cy instance globally for export functions
            window.cyInstance = cy;
        });
        
        // PNG export function using Cytoscape.js built-in method
        function exportPNG() {
            var cy = window.cyInstance;
            if (!cy) {
                alert('Graph not ready. Please try again.');
                return;
            }
            
            // Use cy.png() method with blob-promise output
            var pngPromise = cy.png({
                output: 'blob-promise',
                bg: '#222222',
                full: true,
                scale: 2
            });
            
            pngPromise.then(function(blob) {
                var link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'knowledge_graph.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            }).catch(function(error) {
                console.error('PNG export error:', error);
                alert('Failed to export PNG. Error: ' + error.message);
            });
        }
        
        // SVG export function using cytoscape-svg extension
        function exportSVG() {
            var cy = window.cyInstance;
            if (!cy) return;
            
            try {
                var svgContent = cy.svg({ scale: 1, full: true });
                var blob = new Blob([svgContent], { type: 'image/svg+xml;charset=utf-8' });
                
                var url = URL.createObjectURL(blob);
                var link = document.createElement('a');
                link.href = url;
                link.download = 'knowledge_graph.svg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } catch(e) {
                console.error('SVG export error:', e);
                alert('SVG export failed. The cytoscape-svg extension may not be loaded correctly.');
            }
        }
    </script>
</body>
</html>
    